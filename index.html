<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‹¨ì–´ ì¹˜í™˜ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 40px auto; padding: 0 20px; transition: background 0.3s, color 0.3s; }
    body.dark { background: #222; color: #ddd; }
    textarea, input { width: 100%; padding: 10px; margin-bottom: 12px; font-size: 16px; box-sizing: border-box; background: inherit; color: inherit; border: 1px solid #ccc; }
    body.dark textarea, body.dark input { border-color: #555; }
    .pair { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-bottom: 8px; }
    .pair input { flex: 1 1 40%; min-width: 40%; }
    .pair button { padding: 6px 10px; font-size: 14px; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .copy-btn, .download-btn { position: absolute; top: 5px; right: 5px; padding: 4px 8px; font-size: 12px; cursor: pointer; }
    #output, #inputText { white-space: pre-wrap; background: #f9f9f9; font-size: 16px; line-height: 1.5; }
    body.dark #output, body.dark #inputText { background: #333; }
    #output mark { background-color: yellow; font-weight: bold; }
    .move-btn { background: #eef; border: 1px solid #88f; color: #004; }
    .delete-btn { background: #ffdddd; border: 1px solid #ff9999; color: #a00; }
    @media screen and (max-width: 500px) { .pair input { min-width:100%; flex:1 1 100%; } }
  </style>
</head>
<body>
  <h1>ğŸ”„ ë‹¨ì–´ ì¹˜í™˜ê¸°</h1>
  <button onclick="toggleDarkMode()">ë‹¤í¬ëª¨ë“œ ì „í™˜</button>

  <h3>â‘  ë¬¸ì¥ ì…ë ¥</h3>
  <div style="position:relative;">
    <textarea id="inputText" rows="5" placeholder="ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
    <button class="copy-btn" onclick="copyText('inputText')">ë³µì‚¬</button>
  </div>

  <h3>â‘¡ ë‹¨ì–´ìŒ (ì´ <span id="pairCount">0</span>ê°œ)</h3>
  <input type="file" id="csvUpload" accept=".csv">
  <div id="wordPairs"></div>

  <div class="controls">
    <button onclick="addPair()">+ ë‹¨ì–´ìŒ ì¶”ê°€</button>
    <button onclick="replaceWords()">ğŸ”„ ë³€í™˜</button>
    <button class="download-btn" onclick="downloadCSV()">Download CSV</button>
  </div>

  <h3>â‘¢ ë³€í™˜ëœ ë¬¸ì¥</h3>
  <div style="position:relative;">
    <div id="output" style="min-height:100px; border:1px solid #ddd; padding:10px;"></div>
    <button class="copy-btn" onclick="copyText('output')">ë³µì‚¬</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/[emailÂ protected]/papaparse.min.js"></script>
  <script>
    // ì´ˆê¸° ë¡œë“œ
    document.addEventListener('DOMContentLoaded', () => {
      addPair(); addPair();
      document.getElementById('csvUpload').addEventListener('change', handleCsvUpload);
      updateCount();
    });

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }

    function addPair(from='', to='') {
      const pair = document.createElement('div');
      pair.className = 'pair';
      pair.innerHTML = `
        <input class="from" placeholder="ì›ë³¸ ë‹¨ì–´" value="${from}">
        <input class="to" placeholder="ìˆ˜ì • ë‹¨ì–´" value="${to}">
        <button class="move-btn" onclick="moveUp(this)">â†‘</button>
        <button class="move-btn" onclick="moveDown(this)">â†“</button>
        <button class="delete-btn" onclick="deletePair(this)">âŒ</button>
      `;
      document.getElementById('wordPairs').appendChild(pair);
      pair.querySelectorAll('input').forEach(el => el.addEventListener('input', updateCount));
      updateCount();
    }

    function deletePair(btn) { btn.parentElement.remove(); updateCount(); }
    function moveUp(btn) {
      const cur = btn.parentElement, prev = cur.previousElementSibling;
      if (prev) cur.parentNode.insertBefore(cur, prev);
    }
    function moveDown(btn) {
      const cur = btn.parentElement, nxt = cur.nextElementSibling;
      if (nxt) cur.parentNode.insertBefore(nxt, cur);
    }

    function replaceWords() {
      let text = inputText.value, disp = text;
      document.querySelectorAll('.pair').forEach(({querySelector}) => {
        const from = querySelector('.from').value.trim();
        const to = querySelector('.to').value.trim();
        if (from) disp = disp.replace(new RegExp(from, 'gi'), _ => `<mark>${to}</mark>`);
      });
      output.innerHTML = disp;
    }

    function copyText(id) {
      const el = document.getElementById(id);
      navigator.clipboard.writeText(el.value || el.innerText).then(_ => alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'));
    }

    function updateCount() {
      document.getElementById('pairCount').innerText = document.querySelectorAll('.pair').length;
    }

    function downloadCSV() {
      const rows = Array.from(document.querySelectorAll('.pair'))
        .map(p => {
          const f = p.querySelector('.from').value;
          const t = p.querySelector('.to').value;
          return `"${f}","${t}"`;
        }).join('\n');
      const blob = new Blob([rows], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'words.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    function handleCsvUpload(e) {
      const file = e.target.files[0];
      Papa.parse(file, {
        complete: ({data}) => {
          document.getElementById('wordPairs').innerHTML = '';
          data.forEach(([f, t]) => addPair(f.trim(), t.trim()));
        }
      });
    }
  </script>
</body>
</html>
